# 关于在局域网中共享打印机的一般流程和部分报错解决方案

时间: 2022.06.07

设备: win10为主, 其他版本也可参考



网络拓扑图大致如下:

![image-20220601170619938](img/局域网内共享打印机/image-20220601170619938.png)



## 共享出自身的打印机

### 1.共享打印机

**搜索打印机,打开打印机和扫描仪设置**

![image-20220602160636707](img/局域网内共享打印机/image-20220602160636707.png)



**选择打印机,点击管理,进入打印机设置**

![image-20220602160901771](img/局域网内共享打印机/image-20220602160901771.png)



**打印机属性 -> 共享 -> 勾选共享这台打印机 -> 确定**

![image-20220602161855187](img/局域网内共享打印机/image-20220602161855187.png)

### 2.更改高级共享设置

搜索`共享`进入管理高级共享设置

![image-20220602164008516](img/局域网内共享打印机/image-20220602164008516.png)



把其下`专用`,`来宾或公用`,`所有网络`中的网络发现和共享都勾选上, 最后点击`保存`

![image-20220602165438083](img/局域网内共享打印机/image-20220602165438083.png)

![image-20220602165454013](img/局域网内共享打印机/image-20220602165454013.png)

![image-20220602165543406](img/局域网内共享打印机/image-20220602165543406.png)





## 同层局域网内连接共享打印机`2A`

![image-20220601170619938](img/局域网内共享打印机/image-20220601170619938.png)



### 连接计算机

`2A`线路属于同层网络,在`PC2`的网络中,理应能够直接看到`PC1`的主机,输入凭证连接之后就可以看到被共享的`打印机A`

![image-20220602170946747](img/局域网内共享打印机/image-20220602170946747.png)



如果这里看不到, 需要在地址栏中手动输入`PC1`的地址,来连接`PC1`

![image-20220602172000892](img/局域网内共享打印机/image-20220602172000892.png)



连接时可能需要输入凭证,就是PC1的任意用户名和密码,没有密码的只需要输入用户名即可

![image-20220602172625191](img/局域网内共享打印机/image-20220602172625191.png)

[连接计算机时可能出现无法连接的错误(请参考附录: 无法连接局域网内计算机)](#无法连接局域网内计算机)

### 连接打印机

连接到`PC1`后,就可以看到由`PC1`共享出来的打印机.

双击连接即可,自动安装完驱动后即可正常使用打印服务

[连接打印机失败,请参考附录:  打印机无法连接](#打印机无法连接)

![image-20220602173218852](img/局域网内共享打印机/image-20220602173218852.png)

## 下层网络设备连接上层网络中的共享打印机`3A`

![image-20220601170619938](img/局域网内共享打印机/image-20220601170619938.png)

此线路由于`PC3` 与 `PC1` 分处不同的网段, `PC3` 处于打印机的下级网络中, 

虽然在`PC3` 的网络中大概率无法自动发现`PC1` 的存在,

但是可以通过IP地址,访问`PC1`, [之后步骤则与`2A`线路相同](#2.同层局域网内连接共享打印机`2A`)

## 上层网络设备连接下层网络中的共享打印机`2B`

![](img/局域网内共享打印机/image-20220601170619938.png)

`原理`: 此连接方式,需要使用路由器的`DMZ主机` 功能, 就是将路由器下的某台计算机暴露到与路由器同级的网络中, 使上级设备可以访问到该计算机



### 1.固定路由器WAN 口 IP 地址

![image-20220605171101794](img/局域网内共享打印机/image-20220605171101794.png)



### 2.设置 DMZ 主机

应用管理 -> DMZ主机

![image-20220605171324675](img/局域网内共享打印机/image-20220605171324675.png)



打开 DMZ 开关, 手动填入直连打印机PC的IP地址,或是点击从已连接设备中选择, 选择目标PC, 然后保存

![image-20220605171553275](img/局域网内共享打印机/image-20220605171553275.png)

![image-20220605171617316](img/局域网内共享打印机/image-20220605171617316.png)

### 3.上级设备连接该打印机

此时其他电脑在资源管理器地址栏中,输入`该路由器的WAN口地址`,即可看见被设置为主机的电脑里面所有共享的内容(打印机和文件)

如果看不见,则需要`主机关闭防火墙`

![image-20220605172511723](img/局域网内共享打印机/image-20220605172511723.png)



**但是此时打开该打印机,会发现报错 0x00000709**

![image-20220605172825829](img/局域网内共享打印机/image-20220605172825829.png)



接下来需要修改电脑的`hosts`文件,已正确访问该打印机

打开你的资源管理器，`C:\Windows\System32\drivers\etc` 在这个路径中找到hosts文件，

使用记事本打开他在最后一行添加上路由器的 WAN口IP地址（也就是你要访问的地址）+ 空格 + 打印机连接的PC电脑的名称

![image-20220605173459668](img/局域网内共享打印机/image-20220605173459668.png)



如果无法保存,则需要修改当前用户的`写入/修改权限`

右键hosts文件,选择属性,按照下图修改:

![image-20220605173616246](img/局域网内共享打印机/image-20220605173616246.png)



### 4.通过计算机名称再次访问该打印机



![image-20220605173928226](img/局域网内共享打印机/image-20220605173928226.png)



成功访问之后,可以尝试打印测试页,如果无法打印,并报错 0x00000bbb,请参考[打印机无法打印 0x00000bbb](#打印机无法打印 0x00000bbb)

> 该方式访问共享打印机有时会不稳定, 就是一开始报错 0x00000bbb 过一会儿又能正常使用了, 过两天可能又不能用了, 找不到原因



# 附录

## 无法连接局域网内计算机

[先确认目标主机的共享策略是否设置到位](#1.2 更改高级共享设置)

原理: 在目标主机上修改注册表,使目标主机允许接受不安全的来宾登录到 SMB 服务器

### 打开注册表

组合按键 `Win + R` 打开运行窗口, 输入`regedit` 打开注册表

### 修改注册表

在注册表的地址栏中输入 `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters` 路径, 回车进入该路径

新建一个 `DWORD值(32位)`注册表, 将其命名为 `AllowInsecureGuestAuth`

修改其值为`1`即可

## 打印机无法连接 0x0000011b

### win10 连接失败 0x0000011b

修改`双方`注册表

组合按键 `Win + R` 打开运行窗口, 输入`regedit` 打开注册表

在注册表的地址栏中输入 `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Print` 路径, 回车进入该路径

新建一个 `DWORD值(32位)`注册表, 将其命名为 `RpcAuthnLevelPrivacyEnabled`

修改其值为`0`即可

### 打印机由win10/11发起共享, 其他win10 可正常连接, win7 无法连接 0x0000011b

可在win10/11上尝试网上的修复工具 [fix print spooler V2.0  当下软件园, 个人阿里云盘也有,但无法分享](http://www.downxia.com/downinfo/382986.html), 需要以`管理员身份运行`

还是不行则`无解` 

## 打印机无法连接 0x00004005

将主机的打印机删除,重建后共享, 其他设备也要删除该共享打印机,然后全部重新连接打印机

## 打印机无法打印 0x00000bbb

删除报错PC上的对应打印机,并删除其对应的驱动程序

重启电脑,重新连接打印机,安装驱动程序
